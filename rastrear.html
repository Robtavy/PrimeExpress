<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PrimeExpress — Rastrear</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
<style>
  body{font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial;margin:0;background:#f6f7fb;color:#111}
  header{background:#1e3799;color:#fff;padding:12px 24px;display:flex;align-items:center;justify-content:space-between}
  header img{height:40px}
  nav a{color:#fff;text-decoration:none;margin-left:16px;font-weight:600}
  .wrap{max-width:1100px;margin:28px auto;padding:0 18px}
  h1{text-align:center}
  .controls{text-align:center;margin-top:12px}
  input{padding:12px;border-radius:10px;border:1px solid #ddd;width:300px;max-width:90%}
  button{padding:10px 14px;margin-left:10px;border-radius:10px;border:none;background:#0b63b7;color:#fff;cursor:pointer}
  #map{height:280px;border-radius:12px;margin-top:18px;box-shadow:0 8px 24px rgba(11,38,73,0.06)}
  .panel{background:#fff;padding:12px;margin-top:12px;border-radius:10px;box-shadow:0 6px 18px rgba(11,38,73,0.04)}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .col{flex:1;min-width:220px}
  .muted{color:#6b7280}
  @media(max-width:720px){ .row{flex-direction:column} }
</style>
</head>
<body>
<header>
  <div style="display:flex;align-items:center;gap:12px"><img src="Logo.png" alt="Logo"><strong>PrimeExpress</strong></div>
  <nav><a href="index.html">Home</a><a href="rastrear.html">Rastrear</a></nav>
</header>

<main class="wrap">
  <h1>Rastrear pedido</h1>
  <p style="text-align:center;color:#6b7280">Digite o código de rastreio para ver a localização e informações do pedido (simulação).</p>

  <div class="controls">
    <input id="code" placeholder="Ex: PRX123456" />
    <button onclick="startTrack()">Rastrear</button>
    <button onclick="fillSample('PRX123456')">PRX123456</button>
    <button onclick="fillSample('PRX234567')">PRX234567</button>
    <button onclick="fillSample('PRX987654')">PRX987654</button>
  </div>

  <div id="map"></div>

  <div class="panel row" style="margin-top:14px">
    <div class="col">
      <div><strong>Pedido</strong></div>
      <div id="info_id" class="muted">—</div>
    </div>
    <div class="col">
      <div><strong>Status</strong></div>
      <div id="info_status" class="muted">—</div>
    </div>
    <div class="col">
      <div><strong>Local atual</strong></div>
      <div id="info_loc" class="muted">—</div>
    </div>
    <div class="col">
      <div><strong>Motorista (ID)</strong></div>
      <div id="info_driver" class="muted">—</div>
    </div>
    <div class="col">
      <div><strong>Previsão</strong></div>
      <div id="info_eta" class="muted">—</div>
    </div>
  </div>

</main>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
<script>
  // Sample data mapped to codes (you can expand)
  const sample = {
    'PRX123456': {
      status:'Em trânsito',
      loc:'Rua Oscar Freire, Pinheiros - SP',
      driver:'driver-4582',
      eta:'~35 minutos',
      route:[[-23.5597,-46.6625],[-23.5570,-46.6650],[-23.5540,-46.6675],[-23.5510,-46.6690]]
    },
    'PRX234567': {
      status:'Saiu para entrega',
      loc:'Alameda Santos, Jardins - SP',
      driver:'driver-9911',
      eta:'~12 minutos',
      route:[[-23.5712,-46.6459],[-23.5690,-46.6469],[-23.5660,-46.6480]]
    },
    'PRX987654': {
      status:'Atrasado (trânsito)',
      loc:'Marginal Tietê - sentido Leste - SP',
      driver:'driver-1023',
      eta:'+45 minutos (previsão atualizada)',
      route:[[-23.5270,-46.4960],[-23.5300,-46.4850],[-23.5330,-46.4750],[-23.5360,-46.4650]]
    }
  };

  // Leaflet setup (init empty map)
  let map = L.map('map', {zoomControl:true}).setView([-23.55,-46.63], 12);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
  let marker = L.circleMarker([-23.55,-46.63], {radius:8,color:'#0b63b7',fillColor:'#0b63b7',fillOpacity:1}).addTo(map);
  let poly = L.polyline([], {color:'#0b63b7'}).addTo(map);

  function fillSample(code){ document.getElementById('code').value = code; startTrack(); }

  function startTrack(){
    const code = (document.getElementById('code').value || '').trim().toUpperCase();
    if(!code){ alert('Informe o código de rastreio.'); return; }
    // show basic info
    const data = sample[code];
    document.getElementById('info_id').textContent = code;
    if(!data){
      document.getElementById('info_status').textContent = 'Pedido não encontrado';
      document.getElementById('info_loc').textContent = '—';
      document.getElementById('info_driver').textContent = '—';
      document.getElementById('info_eta').textContent = '—';
      return;
    }
    document.getElementById('info_status').textContent = data.status;
    document.getElementById('info_loc').textContent = data.loc;
    document.getElementById('info_driver').textContent = data.driver;
    document.getElementById('info_eta').textContent = data.eta;

    // animate along route
    const points = data.route;
    let i = 0;
    poly.setLatLngs([]);
    marker.setLatLng(points[0]);
    map.panTo(points[0]);
    // clear any previous interval
    if(window.__trackInterval) clearInterval(window.__trackInterval);
    window.__trackInterval = setInterval(()=>{
      i++;
      if(i>=points.length){ clearInterval(window.__trackInterval); document.getElementById('info_status').textContent = (data.status === 'Atrasado (trânsito)') ? 'Atrasado — aguardando normalização' : 'Entregue (simulação)'; return; }
      marker.setLatLng(points[i]);
      const current = poly.getLatLngs();
      current.push(points[i]);
      poly.setLatLngs(current);
      map.panTo(points[i]);
      // optionally update ETA dynamically (simple decrement simulation)
      // (not implemented complexly here)
    }, 1400);
  }
</script>
</body>
</html>

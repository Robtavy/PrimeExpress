<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PrimeExpress | Rastrear Pedido</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: #f8f9fa;
      color: #0b1727;
      margin: 0;
      padding: 0;
    }

    header {
      background: #0b63b7;
      color: #fff;
      padding: 20px;
      text-align: center;
      font-size: 1.3rem;
      letter-spacing: 1px;
    }

    .container {
      max-width: 1100px;
      margin: 30px auto;
      padding: 20px;
      background: #fff;
      border-radius: 14px;
      box-shadow: 0 4px 18px rgba(0,0,0,0.08);
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 12px;
      margin-bottom: 18px;
    }

    .controls input {
      flex: 1;
      padding: 10px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    .controls button {
      background: #0b63b7;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 16px;
      cursor: pointer;
      transition: 0.3s;
    }

    .controls button:hover {
      background: #094d8a;
    }

    #map {
      height: 320px;
      border-radius: 12px;
      margin-top: 15px;
    }

    .wrap {
      margin-top: 20px;
    }

    .info p {
      margin: 6px 0;
    }

    #history {
      margin-top: 18px;
      padding: 12px;
      background: #f3f5f8;
      border-radius: 8px;
      display: none;
    }

    #timeline li {
      list-style: none;
      padding: 4px 0;
      border-left: 3px solid #0b63b7;
      margin-left: 10px;
      padding-left: 10px;
      color: #333;
    }
  </style>
</head>
<body>

  <header>ðŸšš PrimeExpress â€” Rastreamento em Tempo Real</header>

  <div class="container">
    <div class="controls">
      <input id="code" placeholder="Digite o cÃ³digo de rastreio (ex: PRX123456)">
      <button onclick="startTrack()">Rastrear</button>
    </div>

    <div id="map"></div>

    <div class="wrap">
      <div class="info">
        <p><strong>ID Pedido:</strong> <span id="info_id">â€”</span></p>
        <p><strong>Status:</strong> <span id="info_status">â€”</span></p>
        <p><strong>LocalizaÃ§Ã£o Atual:</strong> <span id="info_loc">â€”</span></p>
        <p><strong>Motorista:</strong> <span id="info_driver">â€”</span></p>
        <p><strong>PrevisÃ£o de Entrega:</strong> <span id="info_eta">â€”</span></p>
      </div>

      <div id="history">
        <strong>HistÃ³rico de Eventos:</strong>
        <ul id="timeline"></ul>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
  const sample = {
    'PRX123456': {
      status: 'Em trÃ¢nsito',
      loc: 'Rua Oscar Freire, Pinheiros - SP',
      driver: 'driver-4582',
      eta: '~35 minutos',
      last_update: '11:08:22',
      speed_kmh: '28 km/h (mÃ©dia)',
      package: '1x Smartphone - frÃ¡gil',
      next_step: 'Rota alternativa aplicada â€” seguindo pela R. Haddock Lobo',
      route: [
        [-23.5597,-46.6625],
        [-23.5570,-46.6650],
        [-23.5540,-46.6675],
        [-23.5510,-46.6690]
      ],
      history: [
        {time:'08:00', text:'Pedido confirmado no sistema pela loja.'},
        {time:'09:15', text:'Coleta realizada no centro de distribuiÃ§Ã£o local.'},
        {time:'10:00', text:'VeÃ­culo saiu do centro de distribuiÃ§Ã£o (ID veÃ­culo: V-2211).'},
        {time:'10:40', text:'Entrou em trÃ¡fego intenso na Av. Paulista; rota alternativa aplicada Ã s 10:42.'}
      ]
    },
    'PRX234567': {
      status: 'Saiu para entrega',
      loc: 'Alameda Santos, Jardins - SP',
      driver: 'driver-9911',
      eta: '~12 minutos',
      last_update: '14:06:05',
      speed_kmh: '18 km/h (zona urbana)',
      package: '2x AcessÃ³rios - embalagem leve',
      next_step: 'Tentativa de contato com cliente para instruÃ§Ãµes de entrega',
      route: [
        [-23.5712,-46.6459],
        [-23.5690,-46.6469],
        [-23.5660,-46.6480]
      ],
      history: [
        {time:'09:00', text:'Pedido recebido e separado no CD.'},
        {time:'09:50', text:'Carregado no veÃ­culo de entrega (ID rota R-77).'},
        {time:'10:30', text:'Saiu para entrega - priority flag.'},
        {time:'13:55', text:'Parada para reabastecimento - 3 minutos.'}
      ]
    },
    'PRX987654': {
      status: 'Atrasado (trÃ¢nsito intenso)',
      loc: 'Marginal TietÃª - sentido Leste - SP',
      driver: 'driver-1023',
      eta: '+45 minutos (previsÃ£o atualizada)',
      last_update: '16:22:40',
      speed_kmh: '10 km/h (parcialmente parado)',
      package: '1x Geladeira - volume grande (necessita dois operadores)',
      next_step: 'Aguardar normalizaÃ§Ã£o do trÃ¡fego; cliente notificado via WhatsApp',
      route: [
        [-23.5270,-46.4960],
        [-23.5300,-46.4850],
        [-23.5330,-46.4750],
        [-23.5360,-46.4650]
      ],
      history: [
        {time:'07:40', text:'Pedido confirmado.'},
        {time:'08:20', text:'Coleta concluÃ­da no CD.'},
        {time:'09:50', text:'Alerta: trÃ¡fego pesado na via expressa; status alterado.'}
      ]
    }
  };

  let map = L.map('map').setView([-23.55,-46.63], 12);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);
  let marker = L.circleMarker([-23.55,-46.63], {radius:8, color:'#0b63b7', fillColor:'#0b63b7', fillOpacity:1}).addTo(map);
  let poly = L.polyline([], {color:'#0b63b7'}).addTo(map);

  function clearTrackingInterval(){
    if(window.__trackInterval) {
      clearInterval(window.__trackInterval);
      window.__trackInterval = null;
    }
  }

  function showHistory(historyArray){
    const historyDiv = document.getElementById('history');
    const timeline = document.getElementById('timeline');
    timeline.innerHTML = '';
    historyArray.forEach(ev => {
      const li = document.createElement('li');
      li.textContent = `${ev.time} â€” ${ev.text}`;
      timeline.appendChild(li);
    });
    historyDiv.style.display = 'block';
  }

  function updateDetails(code, data){
    document.getElementById('info_id').textContent = code;
    document.getElementById('info_status').textContent = data.status;
    document.getElementById('info_loc').textContent = data.loc;
    document.getElementById('info_driver').textContent = data.driver;
    document.getElementById('info_eta').textContent = data.eta;

    let detailsBox = document.getElementById('extended_details');
    if(!detailsBox){
      detailsBox = document.createElement('div');
      detailsBox.id = 'extended_details';
      detailsBox.style.marginTop = '12px';
      detailsBox.style.padding = '12px';
      detailsBox.style.borderRadius = '8px';
      detailsBox.style.background = '#fff';
      detailsBox.style.boxShadow = '0 6px 18px rgba(11,38,73,0.04)';
      document.querySelector('.wrap').appendChild(detailsBox);
    }
    detailsBox.innerHTML = `
      <strong>Ãšltima atualizaÃ§Ã£o:</strong> ${data.last_update} &nbsp; â€¢ &nbsp;
      <strong>Velocidade mÃ©dia:</strong> ${data.speed_kmh} &nbsp; â€¢ &nbsp;
      <strong>Carga:</strong> ${data.package} <br>
      <strong>PrÃ³ximo passo:</strong> ${data.next_step}
    `;
  }

  function animateRoute(points, onComplete){
    clearTrackingInterval();
    poly.setLatLngs([points[0]]);
    marker.setLatLng(points[0]);
    map.panTo(points[0]);
    let i = 0;
    window.__trackInterval = setInterval(()=>{
      i++;
      if(i >= points.length){
        clearTrackingInterval();
        if(typeof onComplete === 'function') onComplete();
        return;
      }
      const pt = points[i];
      marker.setLatLng(pt);
      poly.addLatLng(pt);
      map.panTo(pt);
    }, 1400);
  }

  function startTrack(){
    const code = (document.getElementById('code').value || '').trim().toUpperCase();
    if(!code){ alert('Informe o cÃ³digo de rastreio.'); return; }

    const data = sample[code];
    document.getElementById('info_id').textContent = code || 'â€”';
    if(!data){
      document.getElementById('info_status').textContent = 'Pedido nÃ£o encontrado';
      document.getElementById('info_loc').textContent = 'â€”';
      document.getElementById('info_driver').textContent = 'â€”';
      document.getElementById('info_eta').textContent = 'â€”';
      document.getElementById('history').style.display = 'none';
      poly.setLatLngs([]);
      return;
    }

    updateDetails(code, data);
    showHistory(data.history);
    animateRoute(data.route, ()=>{
      const timeline = document.getElementById('timeline');
      const li = document.createElement('li');
      const timeNow = new Date().toLocaleTimeString();
      li.textContent = `${timeNow} â€” Entregue (simulaÃ§Ã£o)`;
      timeline.appendChild(li);
      document.getElementById('info_status').textContent = 'Entregue (simulaÃ§Ã£o)';
    });
  }

  document.addEventListener('DOMContentLoaded', ()=>{
    document.getElementById('history').style.display = 'none';
  });
  </script>
</body>
</html>
